package vn.smartdev.controller;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.util.StringUtils;import org.springframework.web.bind.annotation.ModelAttribute;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestMethod;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.servlet.ModelAndView;import vn.smartdev.user.dao.entity.User;import vn.smartdev.user.exception.UserAlreadyExistsException;import vn.smartdev.user.manager.UserManager;import javax.management.relation.RoleNotFoundException;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpSession;import java.text.ParseException;/** * Created by Nguyen on 09/12/2016. */@Controller@RequestMapping(value = "/")public class LoginController {    @Autowired    UserManager userManager;    @RequestMapping(value = "/login", method = RequestMethod.GET)    public ModelAndView loginPage(@RequestParam(value = "error",required = false) String error,                                  @RequestParam(value = "logout",	required = false) String logout,                                  HttpServletRequest request,                                  Model model) {        User userForm = new User();        model.addAttribute("userForm", userForm);        ModelAndView modelAndView = new ModelAndView();        if (error != null) {            modelAndView.addObject("error", "Invalid Credentials provided.");            String targetUrl = getRememberMeTargetUrlFromSession(request);            System.out.println(targetUrl);            if(StringUtils.hasText(targetUrl)){                modelAndView.addObject("targetUrl", targetUrl);                modelAndView.addObject("signinPage", true);            }        }        if (logout != null) {            modelAndView.addObject("message", "Logged out from SmartDev successfully.");        }        modelAndView.setViewName("signinPage");        return modelAndView;    }    @RequestMapping(value = "/registration", method = RequestMethod.POST)    public String createUser(@ModelAttribute("userForm") User user, Model model) throws ParseException, UserAlreadyExistsException, RoleNotFoundException {        userManager.save(user);        return "redirect:/";    }    private String getRememberMeTargetUrlFromSession(HttpServletRequest request){        String targetUrl = "";        HttpSession session = request.getSession(false);        if(session!=null){            targetUrl = session.getAttribute("targetUrl")==null?""                    :session.getAttribute("targetUrl").toString();        }        return targetUrl;    }}